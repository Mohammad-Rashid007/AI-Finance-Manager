{% extends 'base.html' %}

{% block title %}{{ account.name }} - AI Finance Manager{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">{{ account.name }}</h1>
    <div>
        <a href="{% url 'financial:account_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left mr-1"></i> Back to Accounts
        </a>
        <a href="{% url 'financial:account_edit' account.id %}" class="btn btn-outline-primary ml-2">
            <i class="fas fa-edit mr-1"></i> Edit
        </a>
        <a href="{% url 'financial:account_delete' account.id %}" class="btn btn-outline-danger ml-2">
            <i class="fas fa-trash-alt mr-1"></i> Delete
        </a>
    </div>
</div>

<div class="row">
    <!-- Account Details -->
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light">
                <h5 class="mb-0">Account Details</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="text-muted">Account Type</label>
                    <p class="mb-0 font-weight-bold">{{ account.get_account_type_display }}</p>
                </div>
                <div class="mb-3">
                    <label class="text-muted">Current Balance</label>
                    <p class="mb-0 font-weight-bold 
                             {% if account.balance >= 0 %}text-success{% else %}text-danger{% endif %}">
                        ₹{{ account.balance|floatformat:2 }} {{ account.currency }}
                    </p>
                </div>
                <div class="mb-3">
                    <label class="text-muted">Status</label>
                    <p class="mb-0">
                        {% if account.is_active %}
                            <span class="badge badge-success">Active</span>
                        {% else %}
                            <span class="badge badge-secondary">Inactive</span>
                        {% endif %}
                    </p>
                </div>
                <div>
                    <label class="text-muted">Last Updated</label>
                    <p class="mb-0">{{ account.updated_at|date:"F j, Y, g:i a" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="col-md-8 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Transactions</h5>
                    <a href="{% url 'financial:transaction_create' %}?account={{ account.id }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus mr-1"></i> Add Transaction
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if transactions %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th class="text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transaction in transactions %}
                                <tr>
                                    <td>{{ transaction.date|date:"M d, Y" }}</td>
                                    <td>
                                        <a href="{% url 'financial:transaction_detail' transaction.id %}">
                                            {{ transaction.description }}
                                        </a>
                                    </td>
                                    <td>
                                        <span class="badge badge-light">
                                            {{ transaction.category.name }}
                                        </span>
                                    </td>
                                    <td class="text-right 
                                        {% if transaction.transaction_type == 'income' %}text-success
                                        {% else %}text-danger{% endif %}">
                                        {% if transaction.transaction_type == 'income' %}+{% else %}-{% endif %}
                                        ₹{{ transaction.amount|floatformat:2 }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-3">
                        <a href="{% url 'financial:transaction_list' %}?account={{ account.id }}" class="btn btn-outline-primary">
                            View All Transactions
                        </a>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                        <p class="mb-0">No transactions recorded for this account yet.</p>
                        <a href="{% url 'financial:transaction_create' %}?account={{ account.id }}" class="btn btn-primary mt-3">
                            <i class="fas fa-plus mr-1"></i> Add Your First Transaction
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Balance History -->
    <div class="col-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">Balance History</h5>
            </div>
            <div class="card-body">
                <div id="balanceChart" style="height: 300px;"></div>
                {% if not balance_history %}
                    <div class="text-center py-4">
                        <p class="text-muted mb-0">Transaction history needed to display balance chart.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if balance_history %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('balanceChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ balance_history.dates|safe }},
                datasets: [{
                    label: 'Account Balance',
                    data: {{ balance_history.balances|safe }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    pointRadius: 3,
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 1,
                    pointHoverRadius: 5,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    xAxes: [{
                        gridLines: {
                            display: false
                        },
                        ticks: {
                            maxTicksLimit: 10
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: false,
                            callback: function(value) {
                                return '₹' + value.toFixed(2);
                            }
                        }
                    }]
                },
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            return 'Balance: ₹' + parseFloat(tooltipItem.value).toFixed(2);
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
{% endif %}

{% endblock %} 